<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Gowsik | Implementing Passwordless Authentication with WebAuthn in Rails</title>
  <meta name="description" content="Learn how to set up WebAuthn in Rails for passwordless authentication, offering a secure and seamless login experience using biometric or hardware-based credentials.">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Implementing Passwordless Authentication with WebAuthn in Rails">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://blog.gowsik.info/posts/passwordless-authentication-using-webauth">
  <meta property="og:description" content="Learn how to set up WebAuthn in Rails for passwordless authentication, offering a secure and seamless login experience using biometric or hardware-based credentials.">
  <meta property="og:site_name" content="Gowsik">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="https://blog.gowsik.info/posts/passwordless-authentication-using-webauth">
  <meta name="twitter:title" content="Implementing Passwordless Authentication with WebAuthn in Rails">
  <meta name="twitter:description" content="Learn how to set up WebAuthn in Rails for passwordless authentication, offering a secure and seamless login experience using biometric or hardware-based credentials.">

  
    <meta property="og:image" content="https://blog.gowsik.info/assets/og-image-39da2ddfef06ae5bdc1b6daa5dcec9e47b2448cbb47e38cce2d4518074bee7ed.jpg">
    <meta name="twitter:image" content="https://blog.gowsik.info/assets/og-image-39da2ddfef06ae5bdc1b6daa5dcec9e47b2448cbb47e38cce2d4518074bee7ed.jpg">
  

  <link href="https://blog.gowsik.info/feed.xml" type="application/rss+xml" rel="alternate" title="Gowsik Last 10 blog posts" />

  

  

    
      <link rel="icon" type="image/x-icon" href="/assets/favicon-dark-4c760f0ea4166cfd4d40fb83b479f89aab382364c8585ae59b500b5260102afa.ico">
      <link rel="apple-touch-icon" href="/assets/apple-touch-icon-dark-d161409442b7e523089f24d08d0a55951549ece7504207c376d53b020713494d.png">
      <link rel="stylesheet" type="text/css" href="/assets/dark-b9d28dbdfd9e6e202befd4ef315790f4113137f7c4b307fd5df6ae0e46ce6a54.css">
    

  

</head>

<body>
  <main>
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav scrollappear">
  <a href="/" class="header-logo" title="Gowsik">Gowsik</a>
  <ul class="header-links">
    
      <li>
        <a href="https://gowsik.info" title="About me" target="_blank">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-about">
  <use href="/assets/about-ecf154b571ab8034ae00aeed91a3b7ad68db80b46d958753ad6216c919486e88.svg#icon-about" xlink:href="/assets/about-ecf154b571ab8034ae00aeed91a3b7ad68db80b46d958753ad6216c919486e88.svg#icon-about"></use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a href="https://twitter.com/gowsik_ragunath" rel="noreferrer noopener" target="_blank" title="Twitter">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-twitter">
  <use href="/assets/twitter-8842c33965263ad1b03a978406826677a668f94125d5837e70ab83f24b3213a7.svg#icon-twitter" xlink:href="/assets/twitter-8842c33965263ad1b03a978406826677a668f94125d5837e70ab83f24b3213a7.svg#icon-twitter"></use>
</svg>

        </a>
      </li>
    
    
    
    
      <li>
        <a href="https://github.com/gowsik-ragunath" rel="noreferrer noopener" target="_blank" title="GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-github">
  <use href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github" xlink:href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
      <li>
        <a href="mailto:v.gowsik@gmail.com" title="Email">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-email">
  <use href="/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email" xlink:href="/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email"></use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a href="/feed.xml" rel="noreferrer noopener" target="_blank" title="RSS">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-rss">
  <use href="/assets/rss-541ec5cea9cefd10d2fcfec01888f3f231a8829940249835fa7b7b3a12ae0d0d.svg#icon-rss" xlink:href="/assets/rss-541ec5cea9cefd10d2fcfec01888f3f231a8829940249835fa7b7b3a12ae0d0d.svg#icon-rss"></use>
</svg>

        </a>
      </li>
    
    
  </ul>
</nav>



        <article class="article scrollappear">
          <header class="article-header">
            <h1>Implementing Passwordless Authentication with WebAuthn in Rails</h1>
            <p>Learn how to set up WebAuthn in Rails for passwordless authentication, offering a secure and seamless login experience using biometric or hardware-based credentials.</p>
            <div class="article-list-footer">
  <span class="article-list-date">
    November 26, 2024
  </span>
  <span class="article-list-divider">-</span>
  <span class="article-list-minutes">
    
    
      7 minute read
    
  </span>
  <span class="article-list-divider">-</span>
  <div class="article-list-tags">
    
      
      <a href="/tag/rails" title="See all posts with tag 'Rails'">Rails</a>
    
  </div>
</div>
          </header>

          <div class="article-content">
            <p>This post is also published in <a href="https://blog.saeloun.com/2024/11/26/passwordless-authentication-using-webauth/">blog.saeloun.com</a>.</p>

<h3 id="what-is-passwordless-authentication">What is Passwordless authentication?</h3>

<p>Passwordless authentication is an authentication method that verifies users identity and grant access to a site or system without using password. Instead, users can authenticate using methods like:</p>

<ul>
  <li>Biometrics: Face ID, Touch ID</li>
  <li>Hardware tokens: Devices like YubiKeys</li>
  <li>Digital tokens: Generated by authenticator apps</li>
  <li>Magic links: Sent to the user’s email</li>
</ul>

<p>This method enhances security and simplifies the login process by eliminating password vulnerabilities.</p>

<h3 id="what-is-webauthn">What is WebAuthn?</h3>

<p><a href="https://w3c.github.io/webauthn/">WebAuthn</a> (Web Authentication API) is a <a href="https://www.w3.org/">W3C</a> and <a href="https://fidoalliance.org/">FIDO</a> standard that provides strong, passwordless authentication using public-key cryptography. It replaces passwords and SMS-based methods with secure, user-friendly solutions.</p>

<h4 id="how-does-webauthn-work">How Does WebAuthn Work?</h4>

<p>1) Public Key Generation (Registration):</p>

<p>     During registration, the authenticator generates a public-private key pair. The public key is sent to the server and stored, while the private key stays securely on the authenticator.</p>

<p>2) Private Key Usage (Authentication):</p>

<p>     During authentication, the server sends a challenge to the user. The authenticator uses the private key to sign the challenge, proving ownership of the private key.</p>

<p>3) Validation:</p>

<p>     The server uses the previously stored public key to verify the signed challenge. If the signature matches, authentication is successful.</p>

<p>The private key never leaves the authenticator, ensuring security.</p>

<h4 id="benefits-of-webauthn">Benefits of WebAuthn:</h4>

<p>1) Protection against phishing attacks</p>

<p>     WebAuthn links the authentication process to the website’s origin, preventing attackers from using fake websites to steal credentials.</p>

<p>2) Impact of Data Breaches:</p>

<p>     Servers only store public keys. Even if compromised, attackers cannot authenticate without the corresponding private key.</p>

<p>3) Simplified Login Experience:</p>

<p>     Users no longer need to remember or store passwords. This reduces reliance on password managers and mitigates risks of reused passwords.</p>

<h4 id="limitations-of-webauthn">Limitations of WebAuthn:</h4>

<p>1) Lost authenticators:</p>

<p>     If user lost the authentication device then they would not be able to gain access to the system, and binding the existing account with new passkey will be difficult.</p>

<p>2) Browser and device compatibility:</p>

<p>     While most modern browsers support WebAuthn, some platform-specific limitations exist. For example, Touch ID or Windows Hello may not work cross-platform.</p>

<h3 id="webauthn-implementation">WebAuthn implementation:</h3>

<p>In Rails application, implementing passwordless authentication can be achieved seamlessly using the <a href="https://github.com/cedarcode/webauthn-ruby">webauthn-ruby</a> gem for backend integration and <a href="https://github.com/github/webauthn-json">webauthn-json</a> for frontend handling. These tools simplify the process of incorporating WebAuthn standards into our application.</p>

<p>To follow along, clone the <a href="https://github.com/cedarcode/webauthn-rails-demo-app">webauthn-rails-demo-app</a> for reference.</p>

<h4 id="1-setup">1) Setup</h4>

<h5 id="install-required-libraries">Install Required Libraries:</h5>

<p>Add the <a href="https://github.com/cedarcode/webauthn-ruby">webauthn-ruby</a> gem in Gemfile:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">gem</span> <span class="s2">"webauthn"</span></code></pre></figure>

<p>Install the <a href="https://github.com/github/webauthn-json">webauthn-json</a> library for frontend operations:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">yarn</span> <span class="nx">add</span> <span class="p">@</span><span class="nd">github</span><span class="sr">/webauthn-json</span></code></pre></figure>

<h5 id="configuration">Configuration:</h5>

<p>Create an initializer to configure WebAuthn:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/initializers/webauthn.rb</span>

<span class="no">WebAuthn</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="c1"># Ensure this matches the URL where app is hosted</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">origin</span> <span class="o">=</span> <span class="no">Rails</span><span class="p">.</span><span class="nf">configuration</span><span class="p">.</span><span class="nf">webauthn_origin</span>

  <span class="c1"># Relying Party name for display purposes</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">rp_name</span> <span class="o">=</span> <span class="s2">"WebAuthn Rails Demo App"</span>
<span class="k">end</span></code></pre></figure>

<ul>
  <li><code class="highlighter-rouge">origin</code> ensures authentication requests come from the app</li>
  <li><code class="highlighter-rouge">rp_name</code> the name shown to users during authentication.</li>
</ul>

<h4 id="2-user-registration">2) User Registration</h4>

<p>During registration, the app creates a public-private key pair, storing only the public key.</p>

<h5 id="backend-generate-registration-options">Backend: Generate Registration Options</h5>

<p>The backend generates WebAuthn options for the frontend to create a public-private key pair.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/registrations_controller.rb</span>

<span class="k">def</span> <span class="nf">create</span>
  <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">username: </span><span class="n">params</span><span class="p">[</span><span class="ss">:registration</span><span class="p">][</span><span class="ss">:username</span><span class="p">])</span>

  <span class="n">create_options</span> <span class="o">=</span> <span class="no">WebAuthn</span><span class="o">::</span><span class="no">Credential</span><span class="p">.</span><span class="nf">options_for_create</span><span class="p">(</span>
    <span class="ss">user: </span><span class="p">{</span> <span class="ss">name: </span><span class="n">user</span><span class="p">.</span><span class="nf">username</span><span class="p">,</span> <span class="ss">id: </span><span class="n">user</span><span class="p">.</span><span class="nf">webauthn_id</span> <span class="p">},</span>
    <span class="ss">authenticator_selection: </span><span class="p">{</span> <span class="ss">user_verification: </span><span class="s2">"required"</span> <span class="p">}</span>
  <span class="p">)</span>

  <span class="n">session</span><span class="p">[</span><span class="ss">:current_registration</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="ss">challenge: </span><span class="n">create_options</span><span class="p">.</span><span class="nf">challenge</span><span class="p">,</span>
    <span class="ss">user_attributes: </span><span class="n">user</span><span class="p">.</span><span class="nf">attributes</span>
  <span class="p">}</span>

  <span class="n">render</span> <span class="ss">json: </span><span class="n">create_options</span>
<span class="k">end</span></code></pre></figure>

<ul>
  <li>A create action request from the frontend with the username is received.</li>
  <li>Generates WebAuthn registration options including a challenge and user details.</li>
  <li>Temporarily stores the challenge and user attributes in the session.</li>
</ul>

<h5 id="frontend-register-credential">Frontend: Register Credential</h5>

<p>The frontend creates a WebAuthn credential using the options from the backend.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// app/javascript/credential.js</span>

<span class="kd">function</span> <span class="nx">create</span><span class="p">(</span><span class="nx">callbackUrl</span><span class="p">,</span> <span class="nx">credentialOptions</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">WebAuthnJSON</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span> <span class="na">publicKey</span><span class="p">:</span> <span class="nx">credentialOptions</span> <span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">credential</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">fetch</span><span class="p">(</span><span class="nx">callbackUrl</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span> <span class="p">},</span>
        <span class="na">body</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">credential</span><span class="p">),</span>
      <span class="p">});</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">Registration failed</span><span class="dl">"</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span></code></pre></figure>

<p>The browser (Chrome) prompts the user to create a WebAuthn credential, offering two options for authentication: using a Smartphone/Security key or their passkey tied to the Chrome profile.</p>

<p><a href="/assets/passwordless-webauthn/passkey-prompt-2c05780d824c24fe6729b8c346bb68937692b0dede5c039fe1dcd02676954be4.png">
  <img src="/assets/passwordless-webauthn/passkey-prompt-2c05780d824c24fe6729b8c346bb68937692b0dede5c039fe1dcd02676954be4.png" alt="" class="zooming img-drop-shadow" data-rjs="/assets/passwordless-webauthn/passkey-prompt-2c05780d824c24fe6729b8c346bb68937692b0dede5c039fe1dcd02676954be4.png" data-zooming-width="500" data-zooming-height="427" />
</a></p>

<p>Choosing the “Use a phone, tablet or security key” option will display a QR code, allowing the user to generate a passkey using phone biometrics. Alternatively, YubiKeys can also be used to generate the WebAuthn credential.</p>

<p><a href="/assets/passwordless-webauthn/device-passkey-fa473493e805b2c6cb417012ae8640f12c8b643021e8d563ab9198d5888a1cf1.png">
  <img src="/assets/passwordless-webauthn/device-passkey-fa473493e805b2c6cb417012ae8640f12c8b643021e8d563ab9198d5888a1cf1.png" alt="" class="zooming img-drop-shadow" data-rjs="/assets/passwordless-webauthn/device-passkey-fa473493e805b2c6cb417012ae8640f12c8b643021e8d563ab9198d5888a1cf1.png" data-zooming-width="500" data-zooming-height="573" />
</a></p>

<p>After the user completes the action, the generated credential is sent to the backend for verification.</p>

<h5 id="backend-verify-registration">Backend: Verify Registration</h5>

<p>The backend verifies the public key credential sent by the frontend.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/registrations_controller.rb</span>

<span class="k">def</span> <span class="nf">callback</span>
  <span class="n">webauthn_credential</span> <span class="o">=</span> <span class="no">WebAuthn</span><span class="o">::</span><span class="no">Credential</span><span class="p">.</span><span class="nf">from_create</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
  <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="ss">:current_registration</span><span class="p">][</span><span class="s2">"user_attributes"</span><span class="p">])</span>

  <span class="n">webauthn_credential</span><span class="p">.</span><span class="nf">verify</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="ss">:current_registration</span><span class="p">][</span><span class="s2">"challenge"</span><span class="p">])</span>

  <span class="n">user</span><span class="p">.</span><span class="nf">credentials</span><span class="p">.</span><span class="nf">build</span><span class="p">(</span>
    <span class="ss">external_id: </span><span class="no">Base64</span><span class="p">.</span><span class="nf">strict_encode64</span><span class="p">(</span><span class="n">webauthn_credential</span><span class="p">.</span><span class="nf">raw_id</span><span class="p">),</span>
    <span class="ss">nickname: </span><span class="n">params</span><span class="p">[</span><span class="ss">:credential_nickname</span><span class="p">],</span>
    <span class="ss">public_key: </span><span class="n">webauthn_credential</span><span class="p">.</span><span class="nf">public_key</span><span class="p">,</span>
    <span class="ss">sign_count: </span><span class="n">webauthn_credential</span><span class="p">.</span><span class="nf">sign_count</span>
  <span class="p">)</span>

  <span class="k">if</span> <span class="n">user</span><span class="p">.</span><span class="nf">save</span>
    <span class="n">sign_in</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="n">render</span> <span class="ss">json: </span><span class="p">{</span> <span class="ss">status: </span><span class="s2">"ok"</span> <span class="p">}</span>
  <span class="k">else</span>
    <span class="n">render</span> <span class="ss">json: </span><span class="p">{</span> <span class="ss">error: </span><span class="s2">"Registration failed"</span> <span class="p">},</span> <span class="ss">status: :unprocessable_entity</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<ul>
  <li>Verifies the challenge using the WebAuthn gem.</li>
  <li>Saves the credential’s public key, nickname, and metadata in the database.</li>
  <li>Signs the user in if registration is successful.</li>
</ul>

<h4 id="3-user-authentication">3) User Authentication:</h4>

<h5 id="backend-generate-authentication-options">Backend: Generate Authentication Options</h5>

<p>The backend sends a challenge and existing credentials for the user to authenticate.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/sessions_controller.rb</span>

<span class="k">def</span> <span class="nf">create</span>
  <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">username: </span><span class="n">session_params</span><span class="p">[</span><span class="ss">:username</span><span class="p">])</span>

  <span class="n">get_options</span> <span class="o">=</span> <span class="no">WebAuthn</span><span class="o">::</span><span class="no">Credential</span><span class="p">.</span><span class="nf">options_for_get</span><span class="p">(</span>
    <span class="ss">allow: </span><span class="n">user</span><span class="p">.</span><span class="nf">credentials</span><span class="p">.</span><span class="nf">pluck</span><span class="p">(</span><span class="ss">:external_id</span><span class="p">),</span>
    <span class="ss">user_verification: </span><span class="s2">"required"</span>
  <span class="p">)</span>

  <span class="n">session</span><span class="p">[</span><span class="ss">:current_authentication</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="ss">challenge: </span><span class="n">get_options</span><span class="p">.</span><span class="nf">challenge</span><span class="p">,</span>
    <span class="ss">username: </span><span class="n">user</span><span class="p">.</span><span class="nf">username</span>
  <span class="p">}</span>

  <span class="n">render</span> <span class="ss">json: </span><span class="n">get_options</span>
<span class="k">end</span></code></pre></figure>

<ul>
  <li>A create action request from the frontend with the username is received.</li>
  <li>Generates authentication options for the frontend using the user’s stored credentials.</li>
  <li>Stores the challenge and username in the session.</li>
</ul>

<h5 id="frontend-authenticate-credential">Frontend: Authenticate Credential</h5>

<p>The frontend authenticates using the stored credential.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// app/javascript/credential.js</span>
<span class="kd">function</span> <span class="kd">get</span><span class="p">(</span><span class="nx">credentialOptions</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">WebAuthnJSON</span><span class="p">.</span><span class="kd">get</span><span class="p">({</span> <span class="na">publicKey</span><span class="p">:</span> <span class="nx">credentialOptions</span> <span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">credential</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">fetch</span><span class="p">(</span><span class="dl">"</span><span class="s2">/session/callback</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span> <span class="p">},</span>
        <span class="na">body</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">credential</span><span class="p">),</span>
      <span class="p">});</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">Authentication failed</span><span class="dl">"</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span></code></pre></figure>

<p>The browser (Chrome) will prompt the user to authenticate using the WebAuthn device.</p>

<p><a href="/assets/passwordless-webauthn/passkey-prompt-2c05780d824c24fe6729b8c346bb68937692b0dede5c039fe1dcd02676954be4.png">
  <img src="/assets/passwordless-webauthn/passkey-prompt-2c05780d824c24fe6729b8c346bb68937692b0dede5c039fe1dcd02676954be4.png" alt="" class="zooming img-drop-shadow" data-rjs="/assets/passwordless-webauthn/passkey-prompt-2c05780d824c24fe6729b8c346bb68937692b0dede5c039fe1dcd02676954be4.png" data-zooming-width="500" data-zooming-height="427" />
</a></p>

<p>After the user successfully completes the action, the credential will be sent to the backend for verification.</p>

<h5 id="backend-verify-authentication">Backend: Verify Authentication</h5>

<p>The backend verifies the signed challenge sent by the frontend.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/controllers/sessions_controller.rb</span>
<span class="k">def</span> <span class="nf">callback</span>
  <span class="n">webauthn_credential</span> <span class="o">=</span> <span class="no">WebAuthn</span><span class="o">::</span><span class="no">Credential</span><span class="p">.</span><span class="nf">from_get</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

  <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">username: </span><span class="n">session</span><span class="p">[</span><span class="ss">:current_authentication</span><span class="p">][</span><span class="s2">"username"</span><span class="p">])</span>
  <span class="n">credential</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="nf">credentials</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span>
    <span class="ss">external_id: </span><span class="no">Base64</span><span class="p">.</span><span class="nf">strict_encode64</span><span class="p">(</span><span class="n">webauthn_credential</span><span class="p">.</span><span class="nf">raw_id</span><span class="p">)</span>
  <span class="p">)</span>

  <span class="n">webauthn_credential</span><span class="p">.</span><span class="nf">verify</span><span class="p">(</span>
    <span class="n">session</span><span class="p">[</span><span class="ss">:current_authentication</span><span class="p">][</span><span class="s2">"challenge"</span><span class="p">],</span>
    <span class="ss">public_key: </span><span class="n">credential</span><span class="p">.</span><span class="nf">public_key</span><span class="p">,</span>
    <span class="ss">sign_count: </span><span class="n">credential</span><span class="p">.</span><span class="nf">sign_count</span><span class="p">,</span>
    <span class="ss">user_verification: </span><span class="kp">true</span>
  <span class="p">)</span>

  <span class="n">credential</span><span class="p">.</span><span class="nf">update!</span><span class="p">(</span><span class="ss">sign_count: </span><span class="n">webauthn_credential</span><span class="p">.</span><span class="nf">sign_count</span><span class="p">)</span>
  <span class="n">sign_in</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>

  <span class="n">render</span> <span class="ss">json: </span><span class="p">{</span> <span class="ss">status: </span><span class="s2">"ok"</span> <span class="p">}</span>
<span class="k">end</span></code></pre></figure>

<ul>
  <li>Verifies the challenge using the public key stored during registration.</li>
  <li>Updates the sign count to ensure no replay attacks.</li>
  <li>Signs the user in if authentication is successful.</li>
</ul>

<h3 id="conclusion">Conclusion:</h3>

<p>WebAuthn simplifies authentication by replacing passwords with secure public key cryptography, offering better protection against phishing and data breaches. Although device dependency can pose challenges, the improved security and user convenience make WebAuthn an excellent choice for modern applications.</p>

<p>A few notable websites and services that use WebAuthn for authentication include:</p>

<ul>
  <li><a href="https://www.google.com/account/about/passkeys/">Google</a></li>
  <li><a href="https://support.microsoft.com/en-us/account-billing/signing-in-with-a-passkey-09a49a86-ca47-406c-8acc-ed0e3c852c6d">Microsoft</a></li>
  <li><a href="https://docs.github.com/en/authentication/authenticating-with-a-passkey/signing-in-with-a-passkey">GitHub</a></li>
  <li><a href="https://support.stripe.com/questions/passkeys-and-stripe-user">Stripe</a></li>
</ul>

<p>By integrating WebAuthn, applications can provide users with a more secure and convenient way to authenticate.</p>

          </div>
          <!-- <div class="article-share">
            
            
            <a href="https://twitter.com/home?status=Implementing+Passwordless+Authentication+with+WebAuthn+in+Rails%20-%20https://blog.gowsik.info/posts/passwordless-authentication-using-webauth%20by%20@gowsik_ragunath" title="Share on Twitter" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6 -18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6 0.8 15 2.5 22.1 -80.5-4-151.9-42.6-199.6-101.3 -8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 0.4 0 0.8 0 1.2 0 47 33.4 86.1 77.7 95 -8.1 2.2-16.7 3.4-25.5 3.4 -6.2 0-12.3-0.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3 -33.1 26-74.9 41.5-120.3 41.5 -7.8 0-15.5-0.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-0.1-8.4-0.3-12.5C462.6 146 479 129 492 109.5z"/></svg>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=https://blog.gowsik.info/posts/passwordless-authentication-using-webauth" title="Share on Facebook" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5 0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"/></svg>
            </a>
          </div> -->

          <!--  -->
        </article>
        <footer class="footer scrollappear">
  <p>
    You can read some random facts <a href="https://www.cs.cmu.edu/~bingbin/" target="_blank">here</a>.
  </p>
</footer>

      </div>
    </div>
  </main>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-V342LMXNEK"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-V342LMXNEK');
  </script>


<script type="text/javascript" src="/assets/vendor-3ee2c63bbac916f96cd7f90e83ab767f058ead1301444c9966f5156911c8be7f.js"></script>


  <script type="text/javascript" src="/assets/webfonts-96493456d319d1bf419afdf8701552d4d486fee6afd304897d4fd81eb4e0cc0b.js"></script>



  <script type="text/javascript" src="/assets/scrollappear-e2da8ea567e418637e31266cc5302126eaa79f62a2273739086358b589a89ee6.js"></script>


<script type="text/javascript" src="/assets/application-cfde13ac81ddaf4351b2e739603e2baf688d0fcc9aba613fe62bbb1c7b037fb9.js"></script>


</body>
</html>
